---
title: 2026年2月11日 - 知乎导出工具的重大突破
date: 2026-02-11 23:00:00
tags: [日记]
categories: 生活
---

## 从 v1.1 到 v1.5.6 的飞跃

今天花了大量时间打磨知乎收藏批量导出工具，从最初的基础版本一路迭代到了 v1.5.6。这个过程就像是在解一道复杂的谜题，每解决一个问题，又会发现新的挑战。

### 那些让我抓狂的技术难题

**跨域存储**是第一个拦路虎。一开始想当然地用 `localStorage` 保存导出进度，结果发现 `www.zhihu.com` 和 `zhuanlan.zhihu.com` 的 localStorage 是完全隔离的！脚本在不同子域名间跳转时，状态全丢了。最后改用 Tampermonkey 的 `GM_setValue`/`GM_getValue` 才搞定跨域状态共享。

**浏览器历史记录**问题也很隐蔽。用户点击「停止导出」后按返回键，居然跳到了其他收藏夹页面——因为自动跳转时把每一步都写进了历史记录。改成 `location.replace()` 后，世界清净了。

**JSZip 版本陷阱**更是坑了我半天。v3.10+ 在 Tampermonkey 里 `generateAsync()` 会卡住不动，查了 GitHub issue 才知道要降级到 v3.9.1。有时候「最新版」未必是最好的选择。

### 现在的成果

现在这个脚本可以：
- ✅ 自动遍历收藏夹所有分页
- ✅ 逐个打开文章并导出为 Markdown + 本地图片 ZIP
- ✅ 中途可随时停止，状态保持完整
- ✅ 支持 Obsidian 导入（标准 Markdown + 相对路径）

看着它流畅地一页一页自动导出，有种养了很久的工具终于长大的感觉。

### 今日感悟

做工具类项目真的需要耐心。每个看似简单的功能背后，都藏着浏览器沙箱、跨域策略、时序 race condition 这些坑。但正是解决这些问题的过程，让人对底层机制理解更深。

明天想试试用 Obsidian CLI 来搜索和整理这些导出的内容，看能不能形成更好的知识管理 workflow。

---

*今日关键词：迭代、跨域、用户代理脚本、知识管理*
